#!/bin/bash
# AIMS Auto-Version Incrementor
# This hook automatically increments the patch version on each commit

# Get current version from package.json
CURRENT_VERSION=$(node -p "require('./package.json').version")

# Split version into parts
IFS='.' read -ra VERSION_PARTS <<< "$CURRENT_VERSION"
MAJOR=${VERSION_PARTS[0]}
MINOR=${VERSION_PARTS[1]}
PATCH=${VERSION_PARTS[2]}

# Increment patch version
NEW_PATCH=$((PATCH + 1))
NEW_VERSION="$MAJOR.$MINOR.$NEW_PATCH"

# Update package.json
npm version $NEW_VERSION --no-git-tag-version

# Get current date
CURRENT_DATE=$(date +%Y-%m-%d)

# Update .env with new version and date
if [ -f ".env" ]; then
  # Remove old version/date lines
  sed -i.bak '/VITE_APP_VERSION/d' .env
  sed -i.bak '/VITE_BUILD_DATE/d' .env

  # Add new version/date
  echo "VITE_APP_VERSION=$NEW_VERSION" >> .env
  echo "VITE_BUILD_DATE=$CURRENT_DATE" >> .env

  # Clean up backup file
  rm -f .env.bak
fi

# Add updated files to commit
git add package.json .env

echo "Version auto-incremented: $CURRENT_VERSION â†’ $NEW_VERSION"
echo "Build date updated: $CURRENT_DATE"
