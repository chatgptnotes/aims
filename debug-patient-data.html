<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug Patient Data</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 30px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    h1 { color: #333; margin-top: 0; }
    h2 { color: #666; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
    button {
      background: #4CAF50;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px 10px 0;
    }
    button:hover { background: #45a049; }
    .result {
      margin-top: 15px;
      padding: 15px;
      border-radius: 4px;
      background: #f9f9f9;
      border-left: 4px solid #ccc;
    }
    .success { background: #e8f5e9; border-left-color: green; }
    .error { background: #ffebee; border-left-color: red; }
    .warning { background: #fff3e0; border-left-color: orange; }
    pre {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      white-space: pre-wrap;
      font-size: 12px;
    }
    input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      box-sizing: border-box;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background: #f5f5f5;
      font-weight: bold;
    }
    .highlight {
      background: yellow;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Debug Patient Data Fetch</h1>
    <p>Yeh tool check karega ki patients table mein data hai ya nahi aur kya fetch ho raha hai.</p>
  </div>

  <div class="container">
    <h2>Test 1: Get All Patients</h2>
    <p>Patients table se sabhi records fetch karo</p>
    <button onclick="getAllPatients()">Get All Patients</button>
    <div id="allPatientsOutput"></div>
  </div>

  <div class="container">
    <h2>Test 2: Find Patient by Email</h2>
    <label><strong>Enter Patient Email:</strong></label>
    <input type="email" id="patientEmail" placeholder="patient@example.com">
    <button onclick="findPatientByEmail()">Find Patient by Email</button>
    <div id="emailSearchOutput"></div>
  </div>

  <div class="container">
    <h2>Test 3: Find Patient by ID</h2>
    <label><strong>Enter Patient ID:</strong></label>
    <input type="text" id="patientId" placeholder="211bd330-d6d1-42a0-a159-4b9fbee82f0f">
    <button onclick="findPatientById()">Find Patient by ID</button>
    <div id="idSearchOutput"></div>
  </div>

  <div class="container">
    <h2>Test 4: Check Auth User</h2>
    <p>Currently logged in user ka data</p>
    <button onclick="checkAuthUser()">Check Logged In User</button>
    <div id="authUserOutput"></div>
  </div>

  <div class="container">
    <h2>Test 5: Find Clinic by ID</h2>
    <label><strong>Enter Clinic ID:</strong></label>
    <input type="text" id="clinicId" placeholder="clinic-id">
    <button onclick="findClinicById()">Find Clinic</button>
    <div id="clinicOutput"></div>
  </div>

  <script>
    const SUPABASE_URL = 'https://omyltmcesgbhnqmhrrvq.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9teWx0bWNlc2diaG5xbWhycnZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU1MzYxMDIsImV4cCI6MjA1MTExMjEwMn0.pG-F3YOFzsVfqBqX7VmADKf3z-KmQ6VrOG1yLWL0VsA';

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function getAllPatients() {
      const output = document.getElementById('allPatientsOutput');
      output.innerHTML = '<div class="result">‚è≥ Fetching all patients...</div>';

      try {
        const { data, error } = await supabase
          .from('patients')
          .select('*');

        if (error) throw error;

        let html = '<div class="result success">';
        html += `<h3>‚úÖ Found ${data.length} patients</h3>`;

        if (data.length === 0) {
          html += '<p class="warning">‚ö†Ô∏è No patients found in database!</p>';
          html += '<p>Patients table is empty. You need to create patient records first.</p>';
        } else {
          html += '<table>';
          html += '<tr><th>ID</th><th>Name</th><th>Email</th><th>Clinic ID</th><th>Phone</th><th>Created</th></tr>';
          data.forEach(patient => {
            html += '<tr>';
            html += `<td>${patient.id}</td>`;
            html += `<td><strong>${patient.name || 'N/A'}</strong></td>`;
            html += `<td>${patient.email || 'N/A'}</td>`;
            html += `<td>${patient.clinic_id || 'NULL'}</td>`;
            html += `<td>${patient.phone || 'NULL'}</td>`;
            html += `<td>${new Date(patient.created_at).toLocaleString()}</td>`;
            html += '</tr>';
          });
          html += '</table>';

          html += '<h4>Full Data:</h4>';
          html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        }

        html += '</div>';
        output.innerHTML = html;
      } catch (error) {
        output.innerHTML = `<div class="result error"><h3>‚ùå Error</h3><p>${error.message}</p></div>`;
      }
    }

    async function findPatientByEmail() {
      const email = document.getElementById('patientEmail').value;
      const output = document.getElementById('emailSearchOutput');

      if (!email) {
        output.innerHTML = '<div class="result error"><p>Please enter an email address!</p></div>';
        return;
      }

      output.innerHTML = `<div class="result">‚è≥ Searching for patient with email: ${email}...</div>`;

      try {
        const { data, error } = await supabase
          .from('patients')
          .select('*')
          .eq('email', email);

        if (error) throw error;

        let html = '<div class="result">';

        if (data.length === 0) {
          html += '<div class="error">';
          html += '<h3>‚ùå No patient found with this email</h3>';
          html += `<p>Email searched: <strong>${email}</strong></p>`;
          html += '<p>Patient with this email does not exist in database.</p>';
          html += '</div>';
        } else {
          html += '<div class="success">';
          html += '<h3>‚úÖ Patient Found!</h3>';
          html += `<p><strong>Name:</strong> ${data[0].name || 'N/A'}</p>`;
          html += `<p><strong>Email:</strong> ${data[0].email}</p>`;
          html += `<p><strong>ID:</strong> ${data[0].id}</p>`;
          html += `<p><strong>Clinic ID:</strong> ${data[0].clinic_id || 'NULL'}</p>`;
          html += `<p><strong>Phone:</strong> ${data[0].phone || 'NULL'}</p>`;
          html += '<h4>Full Data:</h4>';
          html += '<pre>' + JSON.stringify(data[0], null, 2) + '</pre>';
          html += '</div>';
        }

        html += '</div>';
        output.innerHTML = html;
      } catch (error) {
        output.innerHTML = `<div class="result error"><h3>‚ùå Error</h3><p>${error.message}</p></div>`;
      }
    }

    async function findPatientById() {
      const id = document.getElementById('patientId').value;
      const output = document.getElementById('idSearchOutput');

      if (!id) {
        output.innerHTML = '<div class="result error"><p>Please enter a patient ID!</p></div>';
        return;
      }

      output.innerHTML = `<div class="result">‚è≥ Searching for patient with ID: ${id}...</div>`;

      try {
        const { data, error } = await supabase
          .from('patients')
          .select('*')
          .eq('id', id);

        if (error) throw error;

        let html = '<div class="result">';

        if (!data || data.length === 0) {
          html += '<div class="error">';
          html += '<h3>‚ùå No patient found with this ID</h3>';
          html += `<p>ID searched: <strong>${id}</strong></p>`;
          html += '<p>Patient with this ID does not exist in database.</p>';
          html += '</div>';
        } else {
          html += '<div class="success">';
          html += '<h3>‚úÖ Patient Found!</h3>';
          html += `<p><strong>Name:</strong> ${data[0].name || 'N/A'}</p>`;
          html += `<p><strong>Email:</strong> ${data[0].email}</p>`;
          html += `<p><strong>ID:</strong> ${data[0].id}</p>`;
          html += `<p><strong>Clinic ID:</strong> ${data[0].clinic_id || 'NULL'}</p>`;
          html += '<h4>Full Data:</h4>';
          html += '<pre>' + JSON.stringify(data[0], null, 2) + '</pre>';
          html += '</div>';
        }

        html += '</div>';
        output.innerHTML = html;
      } catch (error) {
        output.innerHTML = `<div class="result error"><h3>‚ùå Error</h3><p>${error.message}</p></div>`;
      }
    }

    async function checkAuthUser() {
      const output = document.getElementById('authUserOutput');
      output.innerHTML = '<div class="result">‚è≥ Checking auth user...</div>';

      try {
        const { data: { user }, error } = await supabase.auth.getUser();

        let html = '<div class="result">';

        if (error || !user) {
          html += '<div class="warning">';
          html += '<h3>‚ö†Ô∏è No user logged in</h3>';
          html += '<p>Please login first to see auth user data.</p>';
          html += '</div>';
        } else {
          html += '<div class="success">';
          html += '<h3>‚úÖ Logged In User</h3>';
          html += `<p><strong>User ID:</strong> <span class="highlight">${user.id}</span></p>`;
          html += `<p><strong>Email:</strong> ${user.email}</p>`;
          html += `<p><strong>Role:</strong> ${user.user_metadata?.role || 'Not set'}</p>`;
          html += '<h4>Full User Data:</h4>';
          html += '<pre>' + JSON.stringify(user, null, 2) + '</pre>';
          html += '<h4>üîç Action Items:</h4>';
          html += '<ol>';
          html += '<li>Copy the <strong>User ID</strong> above (highlighted in yellow)</li>';
          html += '<li>Paste it in "Test 3: Find Patient by ID" above</li>';
          html += '<li>Click "Find Patient by ID" to check if patient record exists</li>';
          html += '</ol>';
          html += '</div>';
        }

        html += '</div>';
        output.innerHTML = html;
      } catch (error) {
        output.innerHTML = `<div class="result error"><h3>‚ùå Error</h3><p>${error.message}</p></div>`;
      }
    }

    async function findClinicById() {
      const id = document.getElementById('clinicId').value;
      const output = document.getElementById('clinicOutput');

      if (!id) {
        output.innerHTML = '<div class="result error"><p>Please enter a clinic ID!</p></div>';
        return;
      }

      output.innerHTML = `<div class="result">‚è≥ Searching for clinic with ID: ${id}...</div>`;

      try {
        const { data, error } = await supabase
          .from('clinics')
          .select('*')
          .eq('id', id);

        if (error) throw error;

        let html = '<div class="result">';

        if (!data || data.length === 0) {
          html += '<div class="error">';
          html += '<h3>‚ùå No clinic found with this ID</h3>';
          html += `<p>ID searched: <strong>${id}</strong></p>`;
          html += '</div>';
        } else {
          html += '<div class="success">';
          html += '<h3>‚úÖ Clinic Found!</h3>';
          html += `<p><strong>Name:</strong> ${data[0].name || 'N/A'}</p>`;
          html += `<p><strong>Email:</strong> ${data[0].email}</p>`;
          html += `<p><strong>Phone:</strong> ${data[0].phone || 'N/A'}</p>`;
          html += `<p><strong>Address:</strong> ${data[0].address || 'N/A'}</p>`;
          html += '<h4>Full Data:</h4>';
          html += '<pre>' + JSON.stringify(data[0], null, 2) + '</pre>';
          html += '</div>';
        }

        html += '</div>';
        output.innerHTML = html;
      } catch (error) {
        output.innerHTML = `<div class="result error"><h3>‚ùå Error</h3><p>${error.message}</p></div>`;
      }
    }

    // Auto-run on page load
    window.onload = function() {
      console.log('üîç Patient Data Debug Tool Loaded');
      console.log('Click "Get All Patients" to start debugging');
    };
  </script>
</body>
</html>
