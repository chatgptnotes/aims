<!DOCTYPE html>
<html>
<head>
    <title>AWS Integration Status Checker</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üîç AWS Integration Status Checker</h1>
    
    <button onclick="checkAWSStatus()">Check AWS Integration Status</button>
    <button onclick="checkDataStorage()">Check Data Storage</button>
    <button onclick="checkS3Storage()">Check S3 Reports</button>
    
    <div id="results"></div>

    <script>
        function checkAWSStatus() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>üöÄ AWS Integration Status</h2>';
            
            // Check environment variables
            const awsRegion = import.meta.env?.VITE_AWS_REGION;
            const awsBucket = import.meta.env?.VITE_AWS_BUCKET_NAME;
            const awsAccessKey = import.meta.env?.VITE_AWS_ACCESS_KEY_ID;
            const awsSecretKey = import.meta.env?.VITE_AWS_SECRET_ACCESS_KEY;
            
            results.innerHTML += `
                <div class="info">
                    <h3>üìù Environment Variables</h3>
                    <pre>
AWS Region: ${awsRegion || 'Not set'}
S3 Bucket: ${awsBucket || 'Not set'}
Access Key ID: ${awsAccessKey ? awsAccessKey.substring(0, 10) + '...' : 'Not set'}
Secret Key: ${awsSecretKey ? '***configured***' : 'Not set'}
                    </pre>
                </div>
            `;
            
            // Check if using real AWS vs localStorage
            const usingRealAWS = awsAccessKey && awsAccessKey !== 'your_aws_access_key_id' && 
                                awsSecretKey && awsSecretKey !== 'your_aws_secret_access_key';
            
            if (usingRealAWS) {
                results.innerHTML += '<div class="success">‚úÖ Real AWS credentials detected</div>';
            } else {
                results.innerHTML += '<div class="warning">‚ö†Ô∏è Using localStorage fallback (AWS not configured)</div>';
            }
        }
        
        function checkDataStorage() {
            const results = document.getElementById('results');
            results.innerHTML += '<h2>üíæ Data Storage Analysis</h2>';
            
            // Check localStorage
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const reports = JSON.parse(localStorage.getItem('reports') || '[]');
            const clinics = JSON.parse(localStorage.getItem('clinics') || '[]');
            
            results.innerHTML += `
                <div class="info">
                    <h3>üìä localStorage Data</h3>
                    <pre>
Patients: ${patients.length} records
Reports: ${reports.length} records  
Clinics: ${clinics.length} records
                    </pre>
                </div>
            `;
            
            // Show sample patient data
            if (patients.length > 0) {
                results.innerHTML += `
                    <div class="info">
                        <h3>üë• Sample Patient Data</h3>
                        <pre>${JSON.stringify(patients.slice(0, 2), null, 2)}</pre>
                    </div>
                `;
            }
            
            // Show sample report data
            if (reports.length > 0) {
                results.innerHTML += `
                    <div class="info">
                        <h3>üìÑ Sample Report Data</h3>
                        <pre>${JSON.stringify(reports.slice(0, 2), null, 2)}</pre>
                    </div>
                `;
            }
        }
        
        function checkS3Storage() {
            const results = document.getElementById('results');
            results.innerHTML += '<h2>‚òÅÔ∏è S3 Storage Analysis</h2>';
            
            // Check mock S3 storage
            const mockS3Files = JSON.parse(localStorage.getItem('s3MockFiles') || '[]');
            
            results.innerHTML += `
                <div class="info">
                    <h3>üóÉÔ∏è Mock S3 Files (localStorage)</h3>
                    <pre>
Total Files: ${mockS3Files.length}
                    </pre>
                </div>
            `;
            
            if (mockS3Files.length > 0) {
                results.innerHTML += `
                    <div class="info">
                        <h3>üìÅ Sample S3 Files</h3>
                        <pre>${JSON.stringify(mockS3Files.map(f => ({
                            key: f.key,
                            fileName: f.fileName,
                            size: f.size,
                            hasData: !!f.data
                        })), null, 2)}</pre>
                    </div>
                `;
            }
            
            // Final verdict
            const usingRealS3 = import.meta.env?.VITE_AWS_ACCESS_KEY_ID && 
                               import.meta.env?.VITE_AWS_ACCESS_KEY_ID !== 'your_aws_access_key_id';
            
            if (usingRealS3) {
                results.innerHTML += '<div class="success">‚úÖ Reports should be stored in real AWS S3</div>';
            } else {
                results.innerHTML += '<div class="warning">‚ö†Ô∏è Reports stored in browser localStorage (mock S3)</div>';
            }
        }
        
        // Auto-run checks on page load
        window.onload = function() {
            checkAWSStatus();
            checkDataStorage();
            checkS3Storage();
        };
    </script>
</body>
</html>